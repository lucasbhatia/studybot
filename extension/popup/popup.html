<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StudyBot - Study Library</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div id="app" class="popup-container">
    <!-- Header -->
    <header class="popup-header">
      <h1>StudyBot</h1>
      <button id="settingsBtn" class="icon-btn" title="Settings">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
          <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.62l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.48.12.62l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.62l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.48-.12-.62l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
        </svg>
      </button>
    </header>

    <!-- Search Bar -->
    <div class="search-container">
      <input
        type="text"
        id="searchInput"
        class="search-input"
        placeholder="Search study sets..."
        autocomplete="off"
      >
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar">
      <div class="stat">
        <div class="stat-value" id="totalSets">0</div>
        <div class="stat-label">Sets</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="totalCards">0</div>
        <div class="stat-label">Cards</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="studyStreak">0</div>
        <div class="stat-label">Streak</div>
      </div>
    </div>

    <!-- Study Sets List -->
    <div id="studySetsContainer" class="study-sets-container">
      <div class="empty-state">
        <div class="empty-icon">ðŸ“š</div>
        <p>No study sets yet</p>
        <p class="empty-hint">Extract content from a webpage to create your first study set</p>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="popup-footer">
      <button id="newSetBtn" class="btn btn-primary">+ New Set</button>
      <button id="importBtn" class="btn btn-secondary">Import JSON</button>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Settings</h2>
        <button class="close-btn" id="closeSettings">&times;</button>
      </div>
      
      <div class="modal-body">
        <div class="setting-group">
          <label for="darkModeToggle" class="setting-label">
            <input type="checkbox" id="darkModeToggle" class="checkbox">
            <span>Dark Mode</span>
          </label>
        </div>

        <div class="setting-group">
          <label class="setting-label">AI Detail Level</label>
          <select id="detailLevelSelect" class="select">
            <option value="brief">Brief</option>
            <option value="standard" selected>Standard</option>
            <option value="detailed">Detailed</option>
          </select>
        </div>

        <div class="setting-group">
          <label for="notificationsToggle" class="setting-label">
            <input type="checkbox" id="notificationsToggle" class="checkbox" checked>
            <span>Notifications</span>
          </label>
        </div>

        <hr style="margin: 16px 0; border: none; border-top: 1px solid var(--border);">

        <div class="setting-group">
          <label class="setting-label">AI Generation</label>
          <p style="font-size: 12px; color: var(--secondary); margin: 8px 0;">
            Configure how study materials are generated. You can use your own Claude API key or the default proxy.
          </p>
        </div>

        <div class="setting-group">
          <label for="apiKeyInput" class="setting-label">Claude API Key (Optional)</label>
          <div style="display: flex; gap: 8px;">
            <input type="password" id="apiKeyInput" class="input" placeholder="sk-ant-..." autocomplete="off">
            <button id="testApiKeyBtn" class="btn btn-secondary" style="flex-shrink: 0; white-space: nowrap;">Test</button>
          </div>
          <p style="font-size: 11px; color: var(--secondary); margin-top: 6px;">
            Get your key from <a href="https://console.anthropic.com/account/keys" target="_blank">console.anthropic.com</a>
          </p>
          <div id="apiKeyStatus" style="font-size: 11px; margin-top: 6px; display: none;"></div>
        </div>

        <div class="setting-group">
          <label for="useProxyToggle" class="setting-label">
            <input type="checkbox" id="useProxyToggle" class="checkbox" checked>
            <span>Use Default Proxy (free tier: 5 generations/month)</span>
          </label>
        </div>

        <div class="setting-group" id="usageSection" style="display: none;">
          <label class="setting-label">Monthly Usage</label>
          <div style="display: flex; align-items: center; gap: 8px; margin-top: 8px;">
            <div style="flex: 1; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
              <div id="usageBar" style="height: 100%; width: 0%; background: var(--accent); transition: width 0.3s;"></div>
            </div>
            <div style="font-size: 12px; color: var(--secondary);" id="usageText">0/5</div>
          </div>
        </div>

        <hr style="margin: 16px 0; border: none; border-top: 1px solid var(--border);">

        <div class="setting-group danger">
          <button id="clearDataBtn" class="btn btn-danger">Clear All Data</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Hidden file input for import -->
  <input type="file" id="fileInput" accept=".json" hidden>

  <script src="../lib/storage.js"></script>
  <script src="../lib/claude-api.js"></script>
  <script src="popup.js"></script>
</body>
</html>
